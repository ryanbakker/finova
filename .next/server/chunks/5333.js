exports.id=5333,exports.ids=[5333],exports.modules={9442:(a,b,c)=>{"use strict";c.d(b,{yK:()=>m,NN:()=>q,Sn:()=>o,jR:()=>r,Le:()=>s,UW:()=>n,rr:()=>p,e$:()=>t});var d=c(37864);c(65620);var e=c(54129),f=c(30270),g=c(56037),h=c.n(g);let i=new g.Schema({userId:{type:String,required:!0,index:!0},category:{type:String,required:!0,index:!0},amount:{type:Number,required:!0,min:0},spent:{type:Number,required:!0,min:0,default:0},currency:{type:String,required:!0,default:"USD"},period:{type:String,enum:["monthly","quarterly","yearly"],required:!0,default:"monthly"},startDate:{type:Date,required:!0},endDate:{type:Date,required:!0},isActive:{type:Boolean,default:!0}},{timestamps:!0,collection:"budgets"});i.index({userId:1,category:1}),i.index({userId:1,period:1}),i.index({userId:1,startDate:-1}),i.index({userId:1,isActive:1}),i.index({userId:1,startDate:1,endDate:1});let j=h().model("Budget",i);var k=c(80941),l=c(15767);async function m(a){try{let{userId:b}=await (0,k.j)();if(!b)throw Error("Unauthorized: User not authenticated");if(await (0,f.q)(),await j.findOne({userId:b,category:a.category,period:a.period,isActive:!0,$or:[{startDate:{$lte:a.endDate},endDate:{$gte:a.startDate}}]}))throw Error("A budget already exists for this category and time period");let c=await j.create({...a,userId:b,spent:a.spent||0,isActive:a.isActive??!0});return(0,e.revalidatePath)("/budgeting"),(0,e.revalidatePath)("/dashboard"),JSON.parse(JSON.stringify(c))}catch(a){throw console.error("Error creating budget:",a),(0,l.H4)(a),a}}async function n(){try{let{userId:a}=await (0,k.j)();if(!a)throw Error("Unauthorized: User not authenticated");await (0,f.q)();let b=await j.find({userId:a}).sort({startDate:-1,category:1}).lean();return JSON.parse(JSON.stringify(b))}catch(a){throw console.error("Error fetching user budgets:",a),(0,l.H4)(a),a}}async function o(a){try{let{userId:b}=await (0,k.j)();if(!b)throw Error("Unauthorized: User not authenticated");await (0,f.q)();let c=await j.findOne({_id:a,userId:b}).lean();if(!c)throw Error("Budget not found");return JSON.parse(JSON.stringify(c))}catch(a){throw console.error("Error fetching budget:",a),(0,l.H4)(a),a}}async function p(a){try{let{userId:b}=await (0,k.j)();if(!b)throw Error("Unauthorized: User not authenticated");await (0,f.q)();let{id:c,...d}=a;if(d.category||d.period||d.startDate||d.endDate){let a=await j.findById(c);if(!a||a.userId!==b)throw Error("Budget not found or unauthorized");let e=d.category||a.category,f=d.period||a.period,g=d.startDate||a.startDate,h=d.endDate||a.endDate;if(await j.findOne({_id:{$ne:c},userId:b,category:e,period:f,isActive:!0,$or:[{startDate:{$lte:h},endDate:{$gte:g}}]}))throw Error("A budget already exists for this category and time period")}let g=await j.findOneAndUpdate({_id:c,userId:b},d,{new:!0});if(!g)throw Error("Budget not found or unauthorized");return(0,e.revalidatePath)("/budgeting"),(0,e.revalidatePath)("/dashboard"),JSON.parse(JSON.stringify(g))}catch(a){throw console.error("Error updating budget:",a),(0,l.H4)(a),a}}async function q(a){try{let{userId:b}=await (0,k.j)();if(!b)throw Error("Unauthorized: User not authenticated");await (0,f.q)();let c=await j.findOneAndDelete({_id:a,userId:b});if(!c)throw Error("Budget not found or unauthorized");return(0,e.revalidatePath)("/budgeting"),(0,e.revalidatePath)("/dashboard"),JSON.parse(JSON.stringify(c))}catch(a){throw console.error("Error deleting budget:",a),(0,l.H4)(a),a}}async function r(){try{let{userId:a}=await (0,k.j)();if(!a)throw Error("Unauthorized: User not authenticated");return await (0,f.q)(),(await j.aggregate([{$match:{userId:a,isActive:!0}},{$group:{_id:null,totalBudgets:{$sum:1},totalBudgetAmount:{$sum:"$amount"},totalSpent:{$sum:"$spent"},averageBudget:{$avg:"$amount"},overBudgetCount:{$sum:{$cond:[{$gt:["$spent","$amount"]},1,0]}},warningBudgetCount:{$sum:{$cond:[{$and:[{$lte:["$spent","$amount"]},{$gte:[{$divide:["$spent","$amount"]},.8]}]},1,0]}}}}]))[0]||{totalBudgets:0,totalBudgetAmount:0,totalSpent:0,averageBudget:0,overBudgetCount:0,warningBudgetCount:0}}catch(a){throw console.error("Error fetching budget stats:",a),(0,l.H4)(a),a}}async function s(a){try{let{userId:b}=await (0,k.j)();if(!b)throw Error("Unauthorized: User not authenticated");await (0,f.q)();let c=await j.find({userId:b,period:a,isActive:!0}).sort({startDate:-1}).lean();return JSON.parse(JSON.stringify(c))}catch(a){throw console.error("Error fetching budgets by period:",a),(0,l.H4)(a),a}}async function t(a,b){try{let{userId:c}=await (0,k.j)();if(!c)throw Error("Unauthorized: User not authenticated");await (0,f.q)();let d=await j.findOneAndUpdate({_id:a,userId:c},{spent:Math.max(0,b)},{new:!0});if(!d)throw Error("Budget not found or unauthorized");return(0,e.revalidatePath)("/budgeting"),(0,e.revalidatePath)("/dashboard"),JSON.parse(JSON.stringify(d))}catch(a){throw console.error("Error updating budget spent amount:",a),(0,l.H4)(a),a}}(0,c(76012).D)([m,n,o,p,q,r,s,t]),(0,d.A)(m,"4035751163bf415048e40c285f7fb69094646a00b9",null),(0,d.A)(n,"00f825864066a69d40e48a185e21b89673b0964cc7",null),(0,d.A)(o,"4078d5843f41f884925ebc067343fe5e6e8d4a85e4",null),(0,d.A)(p,"405f8b79b435ed3dc6b3130d63a4aa350debf39cfd",null),(0,d.A)(q,"40b4cb41942c3d3b58f8e1907f31f5827d2e05004b",null),(0,d.A)(r,"0030d7a014f3829e8088006f09692cce01e990fb75",null),(0,d.A)(s,"40357e3d407044d1df33763c65da07e6c63492a087",null),(0,d.A)(t,"607a2e86b17d42be57f7d76798fee30ce0f4a7da94",null)},15301:()=>{},15767:(a,b,c)=>{"use strict";c.d(b,{H4:()=>g,cn:()=>f});var d=c(61384),e=c(23256);function f(...a){return(0,e.QP)((0,d.$)(a))}let g=a=>{let b="An unexpected error occurred",c="UNKNOWN_ERROR",d=500;a instanceof Error?(b=a.message,a.message.includes("Unauthorized")||a.message.includes("not authenticated")?(c="AUTHENTICATION_ERROR",d=401):a.message.includes("not found")?(c="NOT_FOUND_ERROR",d=404):a.message.includes("Validation failed")||a.message.includes("Validation error")?(c="VALIDATION_ERROR",d=400):a.message.includes("Invalid")||a.message.includes("Invalid format")?(c="INVALID_INPUT_ERROR",d=400):a.message.includes("duplicate")||a.message.includes("already exists")?(c="DUPLICATE_ERROR",d=409):(a.message.includes("permission")||a.message.includes("unauthorized"))&&(c="PERMISSION_ERROR",d=403)):"string"==typeof a?(b=a,a.toLowerCase().includes("unauthorized")?(c="AUTHENTICATION_ERROR",d=401):a.toLowerCase().includes("not found")?(c="NOT_FOUND_ERROR",d=404):a.toLowerCase().includes("validation")&&(c="VALIDATION_ERROR",d=400)):"object"==typeof a&&null!==a&&("code"in a&&"number"==typeof a.code&&(d=a.code),"type"in a&&"string"==typeof a.type&&(c=a.type),b=JSON.stringify(a)),console.error("Error Details:",{type:c,message:b,statusCode:d,timestamp:new Date().toISOString(),stack:a instanceof Error?a.stack:void 0});let e=Error(b);throw Object.assign(e,{type:c,statusCode:d,originalError:a}),e}},21381:()=>{},30270:(a,b,c)=>{"use strict";c.d(b,{q:()=>h});var d=c(56037),e=c.n(d);let f=process.env.MONGODB_URL,g=global.mongoose;g||(g=global.mongoose={conn:null,promise:null});let h=async()=>{if(console.log("connectToDB called"),console.log("MONGODB_URL exists:",!!f),f?(console.log("MONGODB_URL (redacted):",f.replace(/(mongodb\+srv?:\/\/)([^:]+):([^@]+)@/,"$1***:***@")),!f.includes("mongodb+srv://")||f.includes("ssl=true")||f.includes("tls=true")||console.log("Warning: MongoDB Atlas connection string detected without explicit SSL parameters")):console.log("MONGODB_URL is undefined"),g.conn)return console.log("Using cached connection"),g.conn;if(!f)throw Error("Missing MONGODB_URL");console.log("Creating new database connection...");let a=f.includes("mongodb+srv://"),b={dbName:"InstantAI",bufferCommands:!1,maxPoolSize:10,serverSelectionTimeoutMS:1e4,socketTimeoutMS:45e3,retryWrites:!0,w:"majority"};a?(Object.assign(b,{ssl:!0,tls:!0,tlsAllowInvalidCertificates:!1,tlsAllowInvalidHostnames:!1,sslCA:void 0,sslCert:void 0,sslKey:void 0,sslPass:void 0}),console.log("Using MongoDB Atlas SSL configuration")):(Object.assign(b,{ssl:!1,tls:!1}),console.log("Using local MongoDB configuration")),console.log("Connection options:",JSON.stringify(b,null,2)),g.promise=g.promise||e().connect(f,b);try{g.conn=await g.promise,console.log("Database connection established successfully")}catch(a){throw console.error("Database connection failed:",a),g.promise=null,a}return g.conn}},46493:(a,b,c)=>{"use strict";c.r(b),c.d(b,{"0030d7a014f3829e8088006f09692cce01e990fb75":()=>d.jR,"00f825864066a69d40e48a185e21b89673b0964cc7":()=>d.UW,"4035751163bf415048e40c285f7fb69094646a00b9":()=>d.yK,"40357e3d407044d1df33763c65da07e6c63492a087":()=>d.Le,"405f8b79b435ed3dc6b3130d63a4aa350debf39cfd":()=>d.rr,"4078d5843f41f884925ebc067343fe5e6e8d4a85e4":()=>d.Sn,"40b4cb41942c3d3b58f8e1907f31f5827d2e05004b":()=>d.NN,"607a2e86b17d42be57f7d76798fee30ce0f4a7da94":()=>d.e$});var d=c(9442)}};